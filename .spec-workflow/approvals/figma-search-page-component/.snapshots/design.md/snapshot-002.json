{
  "id": "snapshot_1764142314052_wcdflktjh",
  "approvalId": "approval_1764142033201_2mdb0gz9c",
  "approvalTitle": "Phase 2: Design - Figma Search Page Component",
  "version": 2,
  "timestamp": "2025-11-26T07:31:54.052Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\n本設計文檔定義了 **Schema-Driven 搜尋頁面組件** 的技術架構與實作細節。該組件是一個可高度配置的 Vue 3 元件，透過 Props Schema 動態生成搜尋表單與資料表格，整合 Syncfusion 企業級 UI 元件庫，支援 Figma 設計稿的快速轉換。\n\n**核心設計原則：**\n- **資料驅動 UI**：所有 UI 元素由 Props Schema 決定，消除硬編碼\n- **單一職責**：組件只負責渲染與事件轉發，不處理商業邏輯\n- **開放封閉原則**：對擴展開放（新欄位類型），對修改封閉（核心邏輯穩定）\n- **型別安全**：完整的 TypeScript 支援，編譯時期錯誤檢查\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\n#### 1. **Framework & Core** (tech.md Line 22-26)\n- ✅ 使用 **Vue 3.5** Composition API (`<script setup>`)\n- ✅ 遵循 **Nuxt 4** 的元件自動導入機制\n- ✅ 整合 **TypeScript 5.9+** 完整型別定義\n\n#### 2. **UI & Styling** (tech.md Line 28-34)\n- ✅ 使用 **Syncfusion Vue Components** 而非 Tailwind CSS 手刻元件\n- ⚠️ 組件內部樣式使用 **Scoped CSS**，不依賴 Tailwind utility classes\n- ✅ 支援 **深色模式**（透過 Syncfusion 主題配置）\n\n#### 3. **State Management** (tech.md Line 36-42)\n- ✅ 組件內部使用 Vue 3 `ref()` 管理本地狀態（`filters`, `isExpanded`）\n- ❌ 不使用 Pinia（組件無需全域狀態）\n- ✅ 使用 VueUse 的 `computed()` 進行響應式計算\n\n#### 4. **Development Workflow** (tech.md Line 157-162)\n- ✅ 支援 **Vite HMR** 熱模組替換\n- ✅ 開發模式下在 `http://localhost:9527/test/search-page` 預覽\n\n#### 5. **Code Quality Tools** (tech.md Line 165-188)\n- ✅ 通過 **ESLint 9.38+** 檢查（包含 Nuxt 官方規則）\n- ✅ 使用 **Prettier 3.4** 統一格式化\n- ✅ 完整 **TypeScript 型別檢查**（`yarn typecheck`）\n- ✅ **Playwright E2E 測試** 覆蓋所有核心功能\n\n### Project Structure (structure.md)\n\n#### 1. **Feature-based Architecture** (structure.md - Feature Layer)\n```\napp/features/search/\n├── components/\n│   └── SearchPage.vue          # 主組件（本設計的核心）\n├── types/\n│   └── search.types.ts         # TypeScript interfaces（可選）\n└── tests/\n    └── SearchPage.spec.ts      # 單元測試（可選）\n```\n\n**對齊說明：**\n- ✅ 組件放置於 `app/features/search/components/`\n- ✅ 遵循 Feature 模組化結構\n- ✅ 不包含 `composables/` 或 `store/`（組件無需共享狀態）\n\n#### 2. **Pages Layer** (structure.md - Pages Layer)\n```\napp/pages/test/\n└── search-page.vue             # 測試頁面（展示組件用法）\n```\n\n#### 3. **Testing Layer**\n```\ntests/e2e/\n└── search-page.spec.ts         # Playwright E2E 測試\n```\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n#### 1. **Syncfusion Vue Components** (已安裝於 package.json)\n- **TextBoxComponent** (`@syncfusion/ej2-vue-inputs`):\n  - 用於：`type: 'text'` 的搜尋欄位\n  - 配置：`v-model`, `placeholder`, `cssClass`\n\n- **DropDownListComponent** (`@syncfusion/ej2-vue-dropdowns`):\n  - 用於：`type: 'dropdown'` 的搜尋欄位\n  - 配置：`v-model`, `dataSource`, `placeholder`\n\n- **DateRangePickerComponent** (`@syncfusion/ej2-vue-calendars`):\n  - 用於：`type: 'daterange'` 的搜尋欄位\n  - 配置：`v-model`, `format`, `placeholder`\n\n- **GridComponent** (`@syncfusion/ej2-vue-grids`):\n  - 用於：表格渲染\n  - 功能：分頁、排序、動態欄位\n  - 配置：`dataSource`, `columns`, `allowPaging`, `allowSorting`\n\n- **ButtonComponent** (`@syncfusion/ej2-vue-buttons`):\n  - 用於：搜尋、清除、展開、新增按鈕\n  - 配置：`iconCss`, `isPrimary`, `cssClass`, `@click`\n\n#### 2. **Nuxt 4 Auto-imports** (tech.md Line 62-63)\n- **unplugin-vue-components**：\n  - 組件可自動導入，無需手動 `import`\n  - 在父組件中使用：`<SearchPage />` 直接可用\n\n### Integration Points\n\n#### 1. **Parent Component Integration**\n- **資料流方向**：Parent → SearchPage (Props) → User Interaction → SearchPage → Parent (Events)\n- **Props 傳遞**：\n  ```vue\n  <SearchPage\n    :searchFields=\"searchFieldsConfig\"\n    :gridColumns=\"gridColumnsConfig\"\n    :gridData=\"tableData\"\n    @search=\"handleSearch\"\n    @add=\"handleAdd\"\n  />\n  ```\n\n#### 2. **API Integration** (由父組件負責)\n- SearchPage 組件本身**不呼叫 API**\n- 父組件在 `@search` 事件中處理 API 呼叫\n- 範例流程：\n  ```\n  User fills search form → Click search button\n  → SearchPage emits @search(filters)\n  → Parent component calls API with filters\n  → Parent updates gridData prop\n  → SearchPage re-renders table\n  ```\n\n#### 3. **State Management Integration**\n- 組件不依賴 Pinia store\n- 如需全域狀態：父組件連接 Pinia → 透過 Props 傳遞給 SearchPage\n\n## Architecture\n\n### Modular Design Principles\n\n#### 1. **Single File Responsibility**\n- `SearchPage.vue`：唯一的組件檔案，職責明確\n  - 渲染搜尋表單（依據 `searchFields` Schema）\n  - 渲染資料表格（依據 `gridColumns` Schema）\n  - 管理本地 UI 狀態（`isExpanded`, `filters`）\n  - 觸發事件（`@search`, `@add`）\n\n#### 2. **Component Isolation**\n- 組件不依賴外部服務或 store\n- 所有資料透過 Props 傳入\n- 所有操作透過 Events 向上傳遞\n- **完全可獨立測試**\n\n#### 3. **Service Layer Separation**\n- ❌ 組件內**不包含**資料存取邏輯\n- ❌ 組件內**不包含**商業邏輯\n- ✅ 組件**只負責** UI 渲染與事件轉發\n\n#### 4. **Utility Modularity**\n- 組件內無需自定義 utility functions\n- 使用 Vue 3 內建 API：`computed()`, `ref()`, `v-for`, `v-if`\n\n### Architecture Diagram\n\n```mermaid\ngraph TD\n    A[Parent Component] -->|Props| B[SearchPage.vue]\n    B -->|@search event| A\n    B -->|@add event| A\n\n    B --> C[Search Form Section]\n    B --> D[Action Buttons]\n    B --> E[Grid Section]\n\n    C --> F[TextBox Syncfusion]\n    C --> G[DropDownList Syncfusion]\n    C --> H[DateRangePicker Syncfusion]\n\n    E --> I[GridComponent Syncfusion]\n    I --> J[Paging]\n    I --> K[Sorting]\n\n    D --> L[Search Button]\n    D --> M[Clear Button]\n    D --> N[Expand/Collapse Button]\n\n    A --> O[API Service Optional]\n    O -->|Update gridData| A\n\n    style B fill:#2877ee,stroke:#183e81,color:#fff\n    style A fill:#e5eaf3,stroke:#7f8996\n    style O fill:#e5eaf3,stroke:#7f8996\n```\n\n### Data Flow\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant SearchPage\n    participant Parent\n    participant API\n\n    User->>SearchPage: Fill search fields\n    User->>SearchPage: Click \"Search\" button\n    SearchPage->>SearchPage: Collect filters state\n    SearchPage->>Parent: emit @search(filters)\n    Parent->>API: POST /api/search (filters)\n    API-->>Parent: Return search results\n    Parent->>SearchPage: Update :gridData prop\n    SearchPage->>User: Display results in Grid\n```\n\n## Components and Interfaces\n\n### Component: SearchPage.vue\n\n#### **Purpose**\n渲染 Schema-Driven 搜尋頁面，包含動態搜尋表單、資料表格、分頁、排序等功能。\n\n#### **Interfaces (Props)**\n\n```typescript\ninterface Props {\n  // 搜尋欄位配置\n  searchFields: SearchFieldSchema[]\n\n  // 表格欄位配置\n  gridColumns: GridColumnSchema[]\n\n  // 表格資料\n  gridData: any[]\n\n  // 新增按鈕文字（可選）\n  addButtonText?: string\n\n  // 搜尋事件處理（可選，與 @search event 二選一）\n  onSearch?: (filters: Record<string, any>) => void\n\n  // 新增事件處理（可選，與 @add event 二選一）\n  onAdd?: () => void\n}\n```\n\n#### **Interfaces (Events)**\n\n```typescript\n// 搜尋事件\nemit('search', filters: Record<string, any>)\n\n// 新增事件\nemit('add')\n```\n\n#### **Dependencies**\n\n**外部依賴：**\n- `@syncfusion/ej2-vue-inputs` - TextBox 元件\n- `@syncfusion/ej2-vue-dropdowns` - DropDownList 元件\n- `@syncfusion/ej2-vue-calendars` - DateRangePicker 元件\n- `@syncfusion/ej2-vue-grids` - Grid 元件（含 Page, Sort, Toolbar 功能）\n- `@syncfusion/ej2-vue-buttons` - Button 元件\n\n**Vue 3 內建 API：**\n- `ref()` - 響應式狀態管理\n- `computed()` - 計算屬性\n- `withDefaults()` - Props 預設值\n- `defineProps()` - Props 定義\n- `defineEmits()` - Events 定義\n\n#### **Reuses**\n- ✅ Syncfusion 元件庫（全域已安裝）\n- ✅ Vue 3 Composition API\n- ✅ TypeScript 型別系統\n\n#### **Internal State**\n\n```typescript\n// 查詢模式（未來擴展用）\nconst queryMode = ref<string>('一般查詢')\n\n// 搜尋區域展開/收起狀態\nconst isExpanded = ref<boolean>(false)\n\n// 搜尋條件集合（動態 key-value pairs）\nconst filters = ref<Record<string, any>>({})\n```\n\n#### **Computed Properties**\n\n```typescript\n// 第一排搜尋欄位（預設顯示）\nconst firstRowFields = computed(() =>\n  props.searchFields.filter(f => f.row === 1 || !f.row)\n)\n\n// 第二排搜尋欄位（折疊狀態）\nconst secondRowFields = computed(() =>\n  props.searchFields.filter(f => f.row === 2)\n)\n```\n\n#### **Methods**\n\n```typescript\n// 處理搜尋按鈕點擊\nfunction handleSearch(): void\n\n// 處理清除按鈕點擊\nfunction handleClear(): void\n\n// 切換展開/收起狀態\nfunction toggleExpand(): void\n\n// 處理新增按鈕點擊\nfunction handleAdd(): void\n```\n\n## Data Models\n\n### Model 1: SearchFieldSchema\n\n**用途：** 定義搜尋欄位的配置結構\n\n```typescript\ninterface SearchFieldSchema {\n  // 唯一識別碼（例如：'queryStatus'）\n  key: string\n\n  // 顯示標籤（例如：'預約狀態'）\n  label: string\n\n  // 欄位類型\n  type: 'text' | 'dropdown' | 'daterange'\n\n  // Placeholder 文字（可選）\n  placeholder?: string\n\n  // Dropdown 選項（當 type='dropdown' 時必填）\n  options?: string[]\n\n  // 欄位寬度（flex-grow 值，預設 1）\n  width?: number\n\n  // 顯示在第幾排（1=第一排預設顯示, 2=第二排折疊）\n  row?: 1 | 2\n}\n```\n\n**範例：**\n```typescript\nconst searchFields: SearchFieldSchema[] = [\n  {\n    key: 'queryStatus',\n    label: '預約狀態',\n    type: 'dropdown',\n    options: ['正常', '已取消', '候補'],\n    placeholder: '請選擇',\n    width: 1,\n    row: 1\n  },\n  {\n    key: 'queryName',\n    label: '預約名稱',\n    type: 'text',\n    placeholder: '請輸入',\n    width: 2,\n    row: 1\n  },\n  {\n    key: 'queryStartDate',\n    label: '開始日期',\n    type: 'daterange',\n    placeholder: '選擇日期範圍',\n    width: 2,\n    row: 2\n  }\n]\n```\n\n### Model 2: GridColumnSchema\n\n**用途：** 定義表格欄位的配置結構\n\n```typescript\ninterface GridColumnSchema {\n  // 資料欄位名稱（對應 gridData 的 key）\n  field: string\n\n  // 表頭文字\n  headerText: string\n\n  // 欄位寬度（像素值，例如：'120'）\n  width?: string\n\n  // 文字對齊方式\n  textAlign?: 'Left' | 'Center' | 'Right'\n\n  // 資料類型（影響排序邏輯）\n  type?: 'string' | 'number' | 'date'\n\n  // 是否渲染為連結\n  isLink?: boolean\n}\n```\n\n**範例：**\n```typescript\nconst gridColumns: GridColumnSchema[] = [\n  {\n    field: 'centerNo',\n    headerText: '預約中心編號',\n    width: '114',\n    textAlign: 'Left',\n    type: 'string',\n    isLink: true\n  },\n  {\n    field: 'amount',\n    headerText: '預約金額',\n    width: '88',\n    textAlign: 'Right',\n    type: 'number'\n  },\n  {\n    field: 'addDate',\n    headerText: '新增日期',\n    width: '100',\n    textAlign: 'Left',\n    type: 'date'\n  }\n]\n```\n\n### Model 3: FiltersState\n\n**用途：** 搜尋條件的動態集合（內部狀態）\n\n```typescript\n// 動態 key-value pairs，key 對應 SearchFieldSchema.key\ntype FiltersState = Record<string, any>\n\n// 範例\nconst filters: FiltersState = {\n  queryStatus: '正常',\n  queryName: 'IBM會議',\n  queryStartDate: [new Date('2025-01-01'), new Date('2025-12-31')]\n}\n```\n\n## Error Handling\n\n### Error Scenarios\n\n#### 1. **Scenario: Props 型別錯誤**\n- **Description**: 開發者傳入錯誤的 Props 型別（例如 `searchFields` 不是陣列）\n- **Handling**:\n  - TypeScript 編譯時報錯（無法執行）\n  - IDE 顯示紅色波浪線提示\n- **User Impact**:\n  - 開發階段被阻止（無法編譯）\n  - 生產環境不會出現此問題\n\n#### 2. **Scenario: Syncfusion 元件載入失敗**\n- **Description**: Syncfusion 套件未安裝或版本不相容\n- **Handling**:\n  - Vite 建置時報錯：`Cannot resolve module '@syncfusion/ej2-vue-inputs'`\n  - 提供清晰的錯誤訊息\n- **User Impact**:\n  - 開發伺服器無法啟動\n  - 需執行 `yarn install` 修復\n\n#### 3. **Scenario: 空陣列 Props**\n- **Description**: `searchFields` 或 `gridColumns` 為空陣列\n- **Handling**:\n  - 組件正常渲染，只是不顯示欄位\n  - 不拋出錯誤或警告\n- **User Impact**:\n  - 顯示空白的搜尋區域或表格\n  - 使用者體驗正常（可能是預期行為）\n\n#### 4. **Scenario: gridData 資料不匹配 gridColumns**\n- **Description**: `gridData` 中缺少 `gridColumns[i].field` 定義的欄位\n- **Handling**:\n  - Syncfusion Grid 顯示空白儲存格\n  - 不拋出 JavaScript 錯誤\n- **User Impact**:\n  - 表格顯示不完整（部分儲存格空白）\n  - 開發者應在父組件檢查資料結構\n\n#### 5. **Scenario: 使用者輸入無效日期**\n- **Description**: DateRangePicker 接收無效的日期格式\n- **Handling**:\n  - Syncfusion 元件內建驗證\n  - 顯示錯誤提示（紅色邊框）\n- **User Impact**:\n  - 無法提交搜尋（搜尋按鈕可點擊，但資料驗證失敗）\n  - 需重新輸入有效日期\n\n#### 6. **Scenario: 搜尋結果為空**\n- **Description**: API 返回空陣列 `gridData: []`\n- **Handling**:\n  - 組件正常渲染空白表格\n  - 顯示 Syncfusion Grid 的預設空狀態\n- **User Impact**:\n  - 看到「無資料」的表格\n  - 可重新搜尋或清除條件\n\n## Testing Strategy\n\n### Unit Testing\n\n**測試框架：** 暫不實作（可選用 Vitest + @vue/test-utils）\n\n**測試範圍：**\n- ❌ 暫不包含單元測試（因為組件主要是 UI 渲染邏輯）\n- ✅ 優先使用 E2E 測試驗證完整功能\n\n**未來可測試：**\n- `computed()` 屬性：`firstRowFields`, `secondRowFields`\n- Methods：`handleSearch()`, `handleClear()`, `toggleExpand()`\n- Props 驗證：傳入錯誤型別時的行為\n\n### Integration Testing\n\n**測試框架：** 暫不實作\n\n**測試範圍：**\n- ❌ 暫不包含整合測試\n- ✅ E2E 測試已覆蓋組件與 Syncfusion 元件的整合\n\n**未來可測試：**\n- SearchPage 與 Syncfusion Grid 的資料綁定\n- SearchPage 與父組件的事件通訊\n- SearchPage 與 API 服務的整合（在父組件層）\n\n### End-to-End Testing\n\n**測試框架：** Playwright\n\n**測試檔案：** `tests/e2e/search-page.spec.ts`\n\n**測試範圍：**（已涵蓋所有 Requirements）\n\n| 測試案例 | 驗證目標 | 對應 Requirement |\n|---|---|---|\n| 1. 第一排搜尋欄位動態渲染 | 驗證 6 個欄位 label 顯示 | Req 1 |\n| 2. 折疊/展開功能 | 驗證第二排欄位顯示/隱藏 | Req 2 |\n| 3. 表格欄位動態渲染 | 驗證 14 個表頭正確顯示 | Req 3 |\n| 4. 表格資料渲染 | 驗證資料正確顯示 | Req 4 |\n| 5. 下拉選單互動 | 驗證選項列表出現 | Req 1 |\n| 6. 搜尋按鈕觸發事件 | 監聽 console.log 驗證 | Req 5 |\n| 7. 分頁功能 | 驗證分頁器與頁碼切換 | Req 4 |\n| 8. 新增按鈕 | 驗證按鈕顯示與事件觸發 | Req 6 |\n| 9. 清除按鈕 | 驗證搜尋條件重置 | Req 5 |\n| 10. 響應式設計 | 驗證 1440px/768px/375px | Req 9 |\n\n**執行方式：**\n```bash\n# 啟動開發伺服器\nyarn dev\n\n# 執行 Playwright 測試\nnpx playwright test tests/e2e/search-page.spec.ts\n```\n\n**測試覆蓋率目標：**\n- ✅ 功能覆蓋：100%（所有 Requirements 都有對應測試）\n- ✅ Schema 驗證：100%（動態渲染正確性）\n- ✅ 事件觸發：100%（@search, @add）\n- ✅ 邊界情況：80%（空陣列、無資料等）\n\n### Test Data Strategy\n\n**Mock Data 位置：** `app/pages/test/search-page.vue`\n\n**資料結構：**\n```typescript\n// 搜尋欄位配置（14 個欄位）\nconst searchFieldsConfig = [...]\n\n// 表格欄位配置（14 個欄位）\nconst gridColumnsConfig = [...]\n\n// 模擬表格資料（15 筆）\nconst mockGridData = [\n  { centerNo: 'CRS000151', progress: '使用者可自訂', ... },\n  ...\n]\n```\n\n**資料來源：** 根據 Figma 設計稿的真實範例資料\n\n## Implementation Notes\n\n### 1. **Syncfusion 版本鎖定**\n- 當前版本：`30.0.0`（package.json 已鎖定）\n- 不建議升級至不相容的版本（需測試）\n\n### 2. **CSS 樣式策略**\n- 使用 `<style scoped>` 避免全域污染\n- 自訂 Syncfusion 元件樣式使用 `:deep()` selector\n- 範例：`:deep(.e-grid .e-headercell) { background: ... }`\n\n### 3. **效能優化**\n- 使用 `v-for` 的 `:key` 綁定唯一 ID（`field.key`）\n- 避免在 template 中使用複雜計算（使用 `computed()`）\n- Syncfusion Grid 內建虛擬滾動（大資料集自動優化）\n\n### 4. **未來擴展點**\n- 新增欄位類型：在 `SearchFieldSchema.type` 擴展 union type\n- 自訂驗證：在父組件層實作，組件保持純粹\n- 多語系支援：透過 Props 傳入翻譯後的 `label` 和 `placeholder`\n\n### 5. **已知限制**\n- 不支援巢狀欄位（例如 `field: 'user.name'`）\n- 不支援自訂 Grid cell template（需修改組件）\n- DateRangePicker 格式固定為 `yyyy/MM/dd`（可擴展）\n",
  "fileStats": {
    "size": 17389,
    "lines": 616,
    "lastModified": "2025-11-26T07:27:05.253Z"
  },
  "comments": []
}